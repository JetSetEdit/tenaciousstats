{"data":"IiIiDQpHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSBBUEkgVXRpbGl0aWVzDQpIYW5kbGVzIGZldGNoaW5nIGRhdGEgZnJvbSBHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSBBUEkNCiIiIg0KDQppbXBvcnQgb3MNCmltcG9ydCBqc29uDQppbXBvcnQgYmFzZTY0DQppbXBvcnQgdGVtcGZpbGUNCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBPcHRpb25hbA0KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YQ0KDQp0cnk6DQogICAgZnJvbSBnb29nbGUub2F1dGgyIGltcG9ydCBzZXJ2aWNlX2FjY291bnQNCiAgICBmcm9tIGdvb2dsZWFwaWNsaWVudC5kaXNjb3ZlcnkgaW1wb3J0IGJ1aWxkDQogICAgZnJvbSBnb29nbGVhcGljbGllbnQuZXJyb3JzIGltcG9ydCBIdHRwRXJyb3INCiAgICBHQlBfQVZBSUxBQkxFID0gVHJ1ZQ0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIEdCUF9BVkFJTEFCTEUgPSBGYWxzZQ0KDQoNCmRlZiBnZXRfY3JlZGVudGlhbHMoKToNCiAgICAiIiJHZXQgR29vZ2xlIEJ1c2luZXNzIFByb2ZpbGUgQVBJIGNyZWRlbnRpYWxzLiIiIg0KICAgIGlmIG5vdCBHQlBfQVZBSUxBQkxFOg0KICAgICAgICByYWlzZSBFeGNlcHRpb24oIkdvb2dsZSBCdXNpbmVzcyBQcm9maWxlIGxpYnJhcmllcyBub3QgYXZhaWxhYmxlIikNCiAgICANCiAgICAjIEhhbmRsZSBjcmVkZW50aWFscyBmb3IgVmVyY2VsIChiYXNlNjQgZW5jb2RlZCkNCiAgICBpZiAnR09PR0xFX0JVU0lORVNTX1BST0ZJTEVfQ1JFREVOVElBTFNfQjY0JyBpbiBvcy5lbnZpcm9uOg0KICAgICAgICBjcmVkc19qc29uID0gYmFzZTY0LmI2NGRlY29kZShvcy5lbnZpcm9uWydHT09HTEVfQlVTSU5FU1NfUFJPRklMRV9DUkVERU5USUFMU19CNjQnXSkuZGVjb2RlKCkNCiAgICAgICAgY3JlZHNfZmlsZSA9IG9zLnBhdGguam9pbih0ZW1wZmlsZS5nZXR0ZW1wZGlyKCksICdnYnBfY3JlZGVudGlhbHMuanNvbicpDQogICAgICAgIHdpdGggb3BlbihjcmVkc19maWxlLCAndycpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKGNyZWRzX2pzb24pDQogICAgICAgIGNyZWRlbnRpYWxzX3BhdGggPSBjcmVkc19maWxlDQogICAgZWxpZiAnR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTJyBpbiBvcy5lbnZpcm9uOg0KICAgICAgICBjcmVkZW50aWFsc19wYXRoID0gb3MuZW52aXJvblsnR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTJ10NCiAgICBlbHNlOg0KICAgICAgICAjIFRyeSBkZWZhdWx0IGxvY2F0aW9uDQogICAgICAgIGNyZWRlbnRpYWxzX3BhdGggPSAnY3JlZGVudGlhbHMuanNvbicNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGNyZWRlbnRpYWxzX3BhdGgpOg0KICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJObyBHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSBjcmVkZW50aWFscyBmb3VuZCIpDQogICAgDQogICAgcmV0dXJuIHNlcnZpY2VfYWNjb3VudC5DcmVkZW50aWFscy5mcm9tX3NlcnZpY2VfYWNjb3VudF9maWxlKA0KICAgICAgICBjcmVkZW50aWFsc19wYXRoLA0KICAgICAgICBzY29wZXM9WydodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL2J1c2luZXNzLm1hbmFnZSddDQogICAgKQ0KDQoNCmRlZiBnZXRfYnVzaW5lc3NfcHJvZmlsZV9jbGllbnQoKToNCiAgICAiIiINCiAgICBSZXR1cm5zIGF1dGhlbnRpY2F0ZWQgR29vZ2xlIEJ1c2luZXNzIFByb2ZpbGUgQVBJIGNsaWVudC4NCiAgICANCiAgICBOb3RlOiBHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSBBUEkgaGFzIGV2b2x2ZWQuIFRoZSBjdXJyZW50IEFQSSBzdHJ1Y3R1cmUNCiAgICBtYXkgdXNlICdteWJ1c2luZXNzYWNjb3VudG1hbmFnZW1lbnQnIG9yICdidXNpbmVzc3Byb2ZpbGVwZXJmb3JtYW5jZScgQVBJcy4NCiAgICBUaGlzIGltcGxlbWVudGF0aW9uIHVzZXMgYSBmbGV4aWJsZSBhcHByb2FjaCB0aGF0IGNhbiBiZSBhZGp1c3RlZC4NCiAgICAiIiINCiAgICBpZiBub3QgR0JQX0FWQUlMQUJMRToNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSBsaWJyYXJpZXMgbm90IGF2YWlsYWJsZSIpDQogICAgDQogICAgY3JlZGVudGlhbHMgPSBnZXRfY3JlZGVudGlhbHMoKQ0KICAgIGVycm9ycyA9IFtdDQogICAgDQogICAgIyBUcnkgZGlmZmVyZW50IEFQSSBuYW1lcyAoR29vZ2xlIGhhcyBjaGFuZ2VkIHRoZSBBUEkgc3RydWN0dXJlIG92ZXIgdGltZSkNCiAgICAjIE9wdGlvbiAxOiBCdXNpbmVzcyBQcm9maWxlIFBlcmZvcm1hbmNlIEFQSSAobmV3ZXIpDQogICAgdHJ5Og0KICAgICAgICBzZXJ2aWNlID0gYnVpbGQoJ2J1c2luZXNzcHJvZmlsZXBlcmZvcm1hbmNlJywgJ3YxJywgY3JlZGVudGlhbHM9Y3JlZGVudGlhbHMpDQogICAgICAgIHJldHVybiBzZXJ2aWNlDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBlcnJvcnMuYXBwZW5kKGYiYnVzaW5lc3Nwcm9maWxlcGVyZm9ybWFuY2U6IHtzdHIoZSl9IikNCiAgICANCiAgICAjIE9wdGlvbiAyOiBNeSBCdXNpbmVzcyBBUEkgKGxlZ2FjeSwgbWF5IHN0aWxsIHdvcmspDQogICAgdHJ5Og0KICAgICAgICBzZXJ2aWNlID0gYnVpbGQoJ215YnVzaW5lc3MnLCAndjQnLCBjcmVkZW50aWFscz1jcmVkZW50aWFscykNCiAgICAgICAgcmV0dXJuIHNlcnZpY2UNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVycm9ycy5hcHBlbmQoZiJteWJ1c2luZXNzIHY0OiB7c3RyKGUpfSIpDQogICAgDQogICAgIyBPcHRpb24gMzogTXkgQnVzaW5lc3MgQWNjb3VudCBNYW5hZ2VtZW50IEFQSQ0KICAgIHRyeToNCiAgICAgICAgc2VydmljZSA9IGJ1aWxkKCdteWJ1c2luZXNzYWNjb3VudG1hbmFnZW1lbnQnLCAndjEnLCBjcmVkZW50aWFscz1jcmVkZW50aWFscykNCiAgICAgICAgcmV0dXJuIHNlcnZpY2UNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVycm9ycy5hcHBlbmQoZiJteWJ1c2luZXNzYWNjb3VudG1hbmFnZW1lbnQ6IHtzdHIoZSl9IikNCiAgICANCiAgICAjIE9wdGlvbiA0OiBNeSBCdXNpbmVzcyBCdXNpbmVzcyBJbmZvcm1hdGlvbiBBUEkgKGZvciByZXZpZXdzKQ0KICAgIHRyeToNCiAgICAgICAgc2VydmljZSA9IGJ1aWxkKCdteWJ1c2luZXNzYnVzaW5lc3NpbmZvcm1hdGlvbicsICd2MScsIGNyZWRlbnRpYWxzPWNyZWRlbnRpYWxzKQ0KICAgICAgICByZXR1cm4gc2VydmljZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgZXJyb3JzLmFwcGVuZChmIm15YnVzaW5lc3NidXNpbmVzc2luZm9ybWF0aW9uOiB7c3RyKGUpfSIpDQogICAgDQogICAgIyBJZiBhbGwgZmFpbCwgcmFpc2Ugd2l0aCBkZXRhaWxzDQogICAgcmFpc2UgRXhjZXB0aW9uKGYiQ291bGQgbm90IGJ1aWxkIEJ1c2luZXNzIFByb2ZpbGUgQVBJIGNsaWVudC4gRXJyb3JzOiB7JzsgJy5qb2luKGVycm9ycyl9IikNCg0KDQpkZWYgZ2V0X2xvY2F0aW9uX2lkKCkgLT4gc3RyOg0KICAgICIiIkdldCBCdXNpbmVzcyBQcm9maWxlIGxvY2F0aW9uIElEIGZyb20gZW52aXJvbm1lbnQuIiIiDQogICAgbG9jYXRpb25faWQgPSBvcy5lbnZpcm9uLmdldCgnQlVTSU5FU1NfUFJPRklMRV9MT0NBVElPTl9JRCcpDQogICAgaWYgbm90IGxvY2F0aW9uX2lkOg0KICAgICAgICByYWlzZSBFeGNlcHRpb24oIkJVU0lORVNTX1BST0ZJTEVfTE9DQVRJT05fSUQgZW52aXJvbm1lbnQgdmFyaWFibGUgbm90IHNldCIpDQogICAgcmV0dXJuIGxvY2F0aW9uX2lkDQoNCg0KZGVmIGZldGNoX3Jldmlld3Moc3RhcnRfZGF0ZTogc3RyLCBlbmRfZGF0ZTogc3RyLCBsaW1pdDogaW50ID0gNTApIC0+IExpc3RbRGljdF06DQogICAgIiIiDQogICAgRmV0Y2ggcmV2aWV3cyBmcm9tIEdvb2dsZSBCdXNpbmVzcyBQcm9maWxlLg0KICAgIA0KICAgIEFyZ3M6DQogICAgICAgIHN0YXJ0X2RhdGU6IFN0YXJ0IGRhdGUgaW4gWVlZWS1NTS1ERCBmb3JtYXQNCiAgICAgICAgZW5kX2RhdGU6IEVuZCBkYXRlIGluIFlZWVktTU0tREQgZm9ybWF0DQogICAgICAgIGxpbWl0OiBNYXhpbXVtIG51bWJlciBvZiByZXZpZXdzIHRvIHJldHVybg0KICAgIA0KICAgIFJldHVybnM6DQogICAgICAgIExpc3Qgb2YgcmV2aWV3IGRpY3Rpb25hcmllcw0KICAgICIiIg0KICAgIGVycm9yX21lc3NhZ2VzID0gW10NCiAgICB0cnk6DQogICAgICAgIHNlcnZpY2UgPSBnZXRfYnVzaW5lc3NfcHJvZmlsZV9jbGllbnQoKQ0KICAgICAgICBsb2NhdGlvbl9pZCA9IGdldF9sb2NhdGlvbl9pZCgpDQogICAgICAgIA0KICAgICAgICAjIFRyeSBkaWZmZXJlbnQgQVBJIHN0cnVjdHVyZXMgYmFzZWQgb24gd2hpY2ggQVBJIGlzIGF2YWlsYWJsZQ0KICAgICAgICByZXZpZXdzID0gW10NCiAgICAgICAgDQogICAgICAgICMgTWV0aG9kIDE6IE15IEJ1c2luZXNzIEFQSSB2NCAobGVnYWN5KQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlcnZpY2UsICdhY2NvdW50cycpOg0KICAgICAgICAgICAgICAgIGFjY291bnRzID0gc2VydmljZS5hY2NvdW50cygpLmxpc3QoKS5leGVjdXRlKCkNCiAgICAgICAgICAgICAgICBpZiBhY2NvdW50cy5nZXQoJ2FjY291bnRzJyk6DQogICAgICAgICAgICAgICAgICAgIGFjY291bnRfbmFtZSA9IGFjY291bnRzWydhY2NvdW50cyddWzBdWyduYW1lJ10NCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25zID0gc2VydmljZS5hY2NvdW50cygpLmxvY2F0aW9ucygpLmxpc3QocGFyZW50PWFjY291bnRfbmFtZSkuZXhlY3V0ZSgpDQogICAgICAgICAgICAgICAgICAgIGlmIGxvY2F0aW9ucy5nZXQoJ2xvY2F0aW9ucycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25fbmFtZSA9IGxvY2F0aW9uc1snbG9jYXRpb25zJ11bMF1bJ25hbWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCA9IHNlcnZpY2UuYWNjb3VudHMoKS5sb2NhdGlvbnMoKS5yZXZpZXdzKCkubGlzdCgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ9bG9jYXRpb25fbmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZT1saW1pdA0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0LmV4ZWN1dGUoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV2aWV3cyA9IHJlc3BvbnNlLmdldCgncmV2aWV3cycsIFtdKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBlcnJvcl9tZXNzYWdlcy5hcHBlbmQoZiJNeSBCdXNpbmVzcyBBUEkgdjQgZXJyb3I6IHtzdHIoZSl9IikNCiAgICAgICAgDQogICAgICAgICMgTWV0aG9kIDI6IEJ1c2luZXNzIFByb2ZpbGUgUGVyZm9ybWFuY2UgQVBJIChuZXdlcikNCiAgICAgICAgaWYgbm90IHJldmlld3M6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgaGFzYXR0cihzZXJ2aWNlLCAnbG9jYXRpb25zJyk6DQogICAgICAgICAgICAgICAgICAgICMgVGhpcyBBUEkgc3RydWN0dXJlIG1heSBkaWZmZXIgLSBhZGp1c3QgYXMgbmVlZGVkDQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBzZXJ2aWNlLmxvY2F0aW9ucygpLnJldmlld3MoKS5saXN0KA0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1mJ2xvY2F0aW9ucy97bG9jYXRpb25faWR9JywNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplPWxpbWl0DQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0LmV4ZWN1dGUoKQ0KICAgICAgICAgICAgICAgICAgICByZXZpZXdzID0gcmVzcG9uc2UuZ2V0KCdyZXZpZXdzJywgW10pDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgZXJyb3JfbWVzc2FnZXMuYXBwZW5kKGYiQnVzaW5lc3MgUHJvZmlsZSBQZXJmb3JtYW5jZSBBUEkgZXJyb3I6IHtzdHIoZSl9IikNCiAgICAgICAgDQogICAgICAgICMgSWYgbm8gcmV2aWV3cyBmb3VuZCwgcmV0dXJuIGVtcHR5IGxpc3QgKEFQSSBtaWdodCBub3QgYmUgc2V0IHVwIHlldCkNCiAgICAgICAgaWYgbm90IHJldmlld3M6DQogICAgICAgICAgICByZXR1cm4gW10NCiAgICAgICAgDQogICAgICAgICMgRmlsdGVyIGJ5IGRhdGUgcmFuZ2UNCiAgICAgICAgZmlsdGVyZWRfcmV2aWV3cyA9IFtdDQogICAgICAgIHN0YXJ0ID0gZGF0ZXRpbWUuc3RycHRpbWUoc3RhcnRfZGF0ZSwgJyVZLSVtLSVkJykNCiAgICAgICAgZW5kID0gZGF0ZXRpbWUuc3RycHRpbWUoZW5kX2RhdGUsICclWS0lbS0lZCcpDQogICAgICAgIA0KICAgICAgICBmb3IgcmV2aWV3IGluIHJldmlld3M6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgY3JlYXRlX3RpbWUgPSByZXZpZXcuZ2V0KCdjcmVhdGVUaW1lJykgb3IgcmV2aWV3LmdldCgncmV2aWV3VGltZScpDQogICAgICAgICAgICAgICAgaWYgY3JlYXRlX3RpbWU6DQogICAgICAgICAgICAgICAgICAgICMgSGFuZGxlIGRpZmZlcmVudCB0aW1lIGZvcm1hdHMNCiAgICAgICAgICAgICAgICAgICAgaWYgJ1QnIGluIGNyZWF0ZV90aW1lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV2aWV3X2RhdGUgPSBkYXRldGltZS5mcm9taXNvZm9ybWF0KGNyZWF0ZV90aW1lLnJlcGxhY2UoJ1onLCAnKzAwOjAwJykpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdfZGF0ZSA9IGRhdGV0aW1lLmZyb21pc29mb3JtYXQoY3JlYXRlX3RpbWUpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiBzdGFydCA8PSByZXZpZXdfZGF0ZSA8PSBlbmQ6DQogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9yZXZpZXdzLmFwcGVuZCh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jldmlld0lkJzogcmV2aWV3LmdldCgncmV2aWV3SWQnKSBvciByZXZpZXcuZ2V0KCduYW1lJywgJycpLnNwbGl0KCcvJylbLTFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGFyUmF0aW5nJzogcmV2aWV3LmdldCgnc3RhclJhdGluZycpIG9yIHJldmlldy5nZXQoJ3JhdGluZycsIDApLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb21tZW50JzogcmV2aWV3LmdldCgnY29tbWVudCcpIG9yIHJldmlldy5nZXQoJ3RleHQnLCAnJyksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZVRpbWUnOiBjcmVhdGVfdGltZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV2aWV3ZXInOiByZXZpZXcuZ2V0KCdyZXZpZXdlcicsIHt9KS5nZXQoJ2Rpc3BsYXlOYW1lJywgJ0Fub255bW91cycpIGlmIGlzaW5zdGFuY2UocmV2aWV3LmdldCgncmV2aWV3ZXInKSwgZGljdCkgZWxzZSAnQW5vbnltb3VzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwbHknOiByZXZpZXcuZ2V0KCdyZXBseScsIHt9KS5nZXQoJ2NvbW1lbnQnKSBpZiByZXZpZXcuZ2V0KCdyZXBseScpIGFuZCBpc2luc3RhbmNlKHJldmlldy5nZXQoJ3JlcGx5JyksIGRpY3QpIGVsc2UgTm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAjIFNraXAgcmV2aWV3cyB3aXRoIHBhcnNpbmcgZXJyb3JzDQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgDQogICAgICAgIHJldHVybiBmaWx0ZXJlZF9yZXZpZXdzWzpsaW1pdF0NCiAgICANCiAgICBleGNlcHQgSHR0cEVycm9yIGFzIGVycm9yOg0KICAgICAgICAjIFJldHVybiBlbXB0eSBsaXN0IGlmIEFQSSBub3QgY29uZmlndXJlZCAoZ3JhY2VmdWwgZGVncmFkYXRpb24pDQogICAgICAgIGlmIGVycm9yLnJlc3Auc3RhdHVzID09IDQwNCBvciBlcnJvci5yZXNwLnN0YXR1cyA9PSA0MDM6DQogICAgICAgICAgICByZXR1cm4gW10NCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKGYiRXJyb3IgZmV0Y2hpbmcgcmV2aWV3czoge2Vycm9yfSIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAjIFJldHVybiBlbXB0eSBsaXN0IGlmIGNyZWRlbnRpYWxzIG5vdCBzZXQgdXAgKGdyYWNlZnVsIGRlZ3JhZGF0aW9uKQ0KICAgICAgICBpZiAnY3JlZGVudGlhbHMnIGluIHN0cihlKS5sb3dlcigpIG9yICdub3QgZm91bmQnIGluIHN0cihlKS5sb3dlcigpOg0KICAgICAgICAgICAgcmV0dXJuIFtdDQogICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmIkVycm9yIGZldGNoaW5nIHJldmlld3M6IHtzdHIoZSl9IikNCg0KDQpkZWYgZmV0Y2hfcmF0aW5nc19zdW1tYXJ5KCkgLT4gRGljdDoNCiAgICAiIiINCiAgICBGZXRjaCByYXRpbmdzIHN1bW1hcnkgZnJvbSBHb29nbGUgQnVzaW5lc3MgUHJvZmlsZS4NCiAgICANCiAgICBSZXR1cm5zOg0KICAgICAgICBEaWN0aW9uYXJ5IHdpdGggcmF0aW5nIHN0YXRpc3RpY3MNCiAgICAiIiINCiAgICB0cnk6DQogICAgICAgICMgR2V0IHJldmlld3MgdG8gY2FsY3VsYXRlIHN1bW1hcnkNCiAgICAgICAgcmV2aWV3cyA9IGZldGNoX3Jldmlld3MoDQogICAgICAgICAgICBzdGFydF9kYXRlPShkYXRldGltZS5ub3coKSAtIHRpbWVkZWx0YShkYXlzPTM2NSkpLnN0cmZ0aW1lKCclWS0lbS0lZCcpLA0KICAgICAgICAgICAgZW5kX2RhdGU9ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZLSVtLSVkJyksDQogICAgICAgICAgICBsaW1pdD0xMDAwDQogICAgICAgICkNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCByZXZpZXdzOg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAnYXZlcmFnZVJhdGluZyc6IDAsDQogICAgICAgICAgICAgICAgJ3RvdGFsUmV2aWV3cyc6IDAsDQogICAgICAgICAgICAgICAgJ3JhdGluZ0Rpc3RyaWJ1dGlvbic6IHsnMSc6IDAsICcyJzogMCwgJzMnOiAwLCAnNCc6IDAsICc1JzogMH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHRvdGFsX3JhdGluZyA9IHN1bShyLmdldCgnc3RhclJhdGluZycsIDApIGZvciByIGluIHJldmlld3MgaWYgci5nZXQoJ3N0YXJSYXRpbmcnKSkNCiAgICAgICAgdmFsaWRfcmV2aWV3cyA9IFtyIGZvciByIGluIHJldmlld3MgaWYgci5nZXQoJ3N0YXJSYXRpbmcnKV0NCiAgICAgICAgDQogICAgICAgIGlmIG5vdCB2YWxpZF9yZXZpZXdzOg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAnYXZlcmFnZVJhdGluZyc6IDAsDQogICAgICAgICAgICAgICAgJ3RvdGFsUmV2aWV3cyc6IDAsDQogICAgICAgICAgICAgICAgJ3JhdGluZ0Rpc3RyaWJ1dGlvbic6IHsnMSc6IDAsICcyJzogMCwgJzMnOiAwLCAnNCc6IDAsICc1JzogMH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGF2ZXJhZ2VfcmF0aW5nID0gdG90YWxfcmF0aW5nIC8gbGVuKHZhbGlkX3Jldmlld3MpDQogICAgICAgIA0KICAgICAgICByYXRpbmdfZGlzdCA9IHsnMSc6IDAsICcyJzogMCwgJzMnOiAwLCAnNCc6IDAsICc1JzogMH0NCiAgICAgICAgZm9yIHJldmlldyBpbiB2YWxpZF9yZXZpZXdzOg0KICAgICAgICAgICAgcmF0aW5nID0gc3RyKGludChyZXZpZXdbJ3N0YXJSYXRpbmcnXSkpDQogICAgICAgICAgICBpZiByYXRpbmcgaW4gcmF0aW5nX2Rpc3Q6DQogICAgICAgICAgICAgICAgcmF0aW5nX2Rpc3RbcmF0aW5nXSArPSAxDQogICAgICAgIA0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgJ2F2ZXJhZ2VSYXRpbmcnOiByb3VuZChhdmVyYWdlX3JhdGluZywgMiksDQogICAgICAgICAgICAndG90YWxSZXZpZXdzJzogbGVuKHZhbGlkX3Jldmlld3MpLA0KICAgICAgICAgICAgJ3JhdGluZ0Rpc3RyaWJ1dGlvbic6IHJhdGluZ19kaXN0DQogICAgICAgIH0NCiAgICANCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICMgUmV0dXJuIGVtcHR5IHN1bW1hcnkgaWYgQVBJIG5vdCBjb25maWd1cmVkDQogICAgICAgIGlmICdjcmVkZW50aWFscycgaW4gc3RyKGUpLmxvd2VyKCkgb3IgJ25vdCBmb3VuZCcgaW4gc3RyKGUpLmxvd2VyKCk6DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICdhdmVyYWdlUmF0aW5nJzogMCwNCiAgICAgICAgICAgICAgICAndG90YWxSZXZpZXdzJzogMCwNCiAgICAgICAgICAgICAgICAncmF0aW5nRGlzdHJpYnV0aW9uJzogeycxJzogMCwgJzInOiAwLCAnMyc6IDAsICc0JzogMCwgJzUnOiAwfQ0KICAgICAgICAgICAgfQ0KICAgICAgICByYWlzZSBFeGNlcHRpb24oZiJFcnJvciBmZXRjaGluZyByYXRpbmdzIHN1bW1hcnk6IHtzdHIoZSl9IikNCg0KDQpkZWYgZmV0Y2hfYnVzaW5lc3NfaW5zaWdodHMoc3RhcnRfZGF0ZTogc3RyLCBlbmRfZGF0ZTogc3RyKSAtPiBEaWN0Og0KICAgICIiIg0KICAgIEZldGNoIGJ1c2luZXNzIGluc2lnaHRzIGZyb20gR29vZ2xlIEJ1c2luZXNzIFByb2ZpbGUuDQogICAgDQogICAgQXJnczoNCiAgICAgICAgc3RhcnRfZGF0ZTogU3RhcnQgZGF0ZSBpbiBZWVlZLU1NLUREIGZvcm1hdA0KICAgICAgICBlbmRfZGF0ZTogRW5kIGRhdGUgaW4gWVlZWS1NTS1ERCBmb3JtYXQNCiAgICANCiAgICBSZXR1cm5zOg0KICAgICAgICBEaWN0aW9uYXJ5IHdpdGggYnVzaW5lc3MgaW5zaWdodHMNCiAgICAiIiINCiAgICB0cnk6DQogICAgICAgIHNlcnZpY2UgPSBnZXRfYnVzaW5lc3NfcHJvZmlsZV9jbGllbnQoKQ0KICAgICAgICBsb2NhdGlvbl9pZCA9IGdldF9sb2NhdGlvbl9pZCgpDQogICAgICAgIA0KICAgICAgICAjIEJ1c2luZXNzIFByb2ZpbGUgUGVyZm9ybWFuY2UgQVBJIHN0cnVjdHVyZQ0KICAgICAgICAjIFRoaXMgaXMgYSBwbGFjZWhvbGRlciAtIGFjdHVhbCBpbXBsZW1lbnRhdGlvbiBkZXBlbmRzIG9uIEFQSSBhdmFpbGFiaWxpdHkNCiAgICAgICAgIyBUaGUgQVBJIG1heSByZXF1aXJlIGRpZmZlcmVudCBlbmRwb2ludHMgb3IgYXV0aGVudGljYXRpb24NCiAgICAgICAgDQogICAgICAgICMgVHJ5IHRvIGZldGNoIGluc2lnaHRzIHVzaW5nIEJ1c2luZXNzIFByb2ZpbGUgUGVyZm9ybWFuY2UgQVBJDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VydmljZSwgJ2xvY2F0aW9ucycpOg0KICAgICAgICAgICAgICAgICMgVGhpcyB3b3VsZCB1c2UgdGhlIHBlcmZvcm1hbmNlIEFQSSBlbmRwb2ludHMNCiAgICAgICAgICAgICAgICAjIFN0cnVjdHVyZSBtYXkgdmFyeSBiYXNlZCBvbiBhY3R1YWwgQVBJIHZlcnNpb24NCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIFJldHVybiBkZWZhdWx0IHN0cnVjdHVyZSBpZiBBUEkgbm90IGF2YWlsYWJsZQ0KICAgICAgICAjIFRoaXMgYWxsb3dzIHRoZSBmcm9udGVuZCB0byB3b3JrIGV2ZW4gaWYgaW5zaWdodHMgYXJlbid0IGNvbmZpZ3VyZWQNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICdzZWFyY2hRdWVyaWVzJzogW10sDQogICAgICAgICAgICAnY3VzdG9tZXJBY3Rpb25zJzogew0KICAgICAgICAgICAgICAgICdjYWxscyc6IDAsDQogICAgICAgICAgICAgICAgJ3dlYnNpdGVDbGlja3MnOiAwLA0KICAgICAgICAgICAgICAgICdkaXJlY3Rpb25SZXF1ZXN0cyc6IDANCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAndmlld3MnOiB7DQogICAgICAgICAgICAgICAgJ3NlYXJjaCc6IDAsDQogICAgICAgICAgICAgICAgJ21hcHMnOiAwLA0KICAgICAgICAgICAgICAgICdkaXNjb3ZlcnknOiAwDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgJ25vdGUnOiAnQnVzaW5lc3MgUHJvZmlsZSBJbnNpZ2h0cyBBUEkgcmVxdWlyZXMgYWRkaXRpb25hbCBzZXR1cC4gU2VlIEdPT0dMRV9CVVNJTkVTU19QUk9GSUxFX1BMQU4ubWQnDQogICAgICAgIH0NCiAgICANCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICMgUmV0dXJuIGRlZmF1bHQgc3RydWN0dXJlIGlmIEFQSSBub3QgY29uZmlndXJlZCAoZ3JhY2VmdWwgZGVncmFkYXRpb24pDQogICAgICAgIGlmICdjcmVkZW50aWFscycgaW4gc3RyKGUpLmxvd2VyKCkgb3IgJ25vdCBmb3VuZCcgaW4gc3RyKGUpLmxvd2VyKCk6DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICdzZWFyY2hRdWVyaWVzJzogW10sDQogICAgICAgICAgICAgICAgJ2N1c3RvbWVyQWN0aW9ucyc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2NhbGxzJzogMCwNCiAgICAgICAgICAgICAgICAgICAgJ3dlYnNpdGVDbGlja3MnOiAwLA0KICAgICAgICAgICAgICAgICAgICAnZGlyZWN0aW9uUmVxdWVzdHMnOiAwDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAndmlld3MnOiB7DQogICAgICAgICAgICAgICAgICAgICdzZWFyY2gnOiAwLA0KICAgICAgICAgICAgICAgICAgICAnbWFwcyc6IDAsDQogICAgICAgICAgICAgICAgICAgICdkaXNjb3ZlcnknOiAwDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAnbm90ZSc6ICdCdXNpbmVzcyBQcm9maWxlIEluc2lnaHRzIEFQSSBub3QgY29uZmlndXJlZCcNCiAgICAgICAgICAgIH0NCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKGYiRXJyb3IgZmV0Y2hpbmcgYnVzaW5lc3MgaW5zaWdodHM6IHtzdHIoZSl9IikNCg0KDQojIEV4YW1wbGUgdXNhZ2UgYW5kIHRlc3RpbmcNCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgIyBUZXN0IGNyZWRlbnRpYWxzDQogICAgdHJ5Og0KICAgICAgICBjcmVkZW50aWFscyA9IGdldF9jcmVkZW50aWFscygpDQogICAgICAgIHByaW50KCLinIUgQ3JlZGVudGlhbHMgbG9hZGVkIHN1Y2Nlc3NmdWxseSIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIuKdjCBFcnJvciBsb2FkaW5nIGNyZWRlbnRpYWxzOiB7ZX0iKQ0KICAgIA0KICAgICMgVGVzdCBBUEkgYXZhaWxhYmlsaXR5DQogICAgaWYgR0JQX0FWQUlMQUJMRToNCiAgICAgICAgcHJpbnQoIuKchSBHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSBsaWJyYXJpZXMgYXZhaWxhYmxlIikNCiAgICBlbHNlOg0KICAgICAgICBwcmludCgi4p2MIEdvb2dsZSBCdXNpbmVzcyBQcm9maWxlIGxpYnJhcmllcyBub3QgaW5zdGFsbGVkIikNCiAgICAgICAgcHJpbnQoIkluc3RhbGwgd2l0aDogcGlwIGluc3RhbGwgZ29vZ2xlLWFwaS1weXRob24tY2xpZW50IGdvb2dsZS1hdXRoLWh0dHBsaWIyIGdvb2dsZS1hdXRoLW9hdXRobGliIikNCg0K"}