{"data":"IiIiClZlcmNlbCBTZXJ2ZXJsZXNzIEZ1bmN0aW9uIC0gTWFpbiBBUEkgaGFuZGxlcgpTaW1wbGlmaWVkIHN0cnVjdHVyZSBmb3IgVmVyY2VsIFB5dGhvbiBydW50aW1lCiIiIgoKaW1wb3J0IG9zCmltcG9ydCBqc29uCmZyb20gaHR0cC5zZXJ2ZXIgaW1wb3J0IEJhc2VIVFRQUmVxdWVzdEhhbmRsZXIKZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHVybHBhcnNlLCBwYXJzZV9xcwppbXBvcnQgc3lzCgojIEFkZCBwYXJlbnQgZGlyZWN0b3J5IHRvIHBhdGggZm9yIGltcG9ydHMKc3lzLnBhdGguaW5zZXJ0KDAsIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkpKQoKIyBUcnkgdG8gaW1wb3J0IEdBNCBjbGllbnQgKHdpbGwgZmFpbCBncmFjZWZ1bGx5IGlmIG5vdCBhdmFpbGFibGUpCnRyeToKICAgIGZyb20gZ29vZ2xlLmFuYWx5dGljcy5kYXRhX3YxYmV0YSBpbXBvcnQgQmV0YUFuYWx5dGljc0RhdGFDbGllbnQKICAgIGZyb20gZ29vZ2xlLmFuYWx5dGljcy5kYXRhX3YxYmV0YS50eXBlcyBpbXBvcnQgKAogICAgICAgIERhdGVSYW5nZSwKICAgICAgICBEaW1lbnNpb24sCiAgICAgICAgTWV0cmljLAogICAgICAgIFJ1blJlcG9ydFJlcXVlc3QsCiAgICApCiAgICBHQTRfQVZBSUxBQkxFID0gVHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBHQTRfQVZBSUxBQkxFID0gRmFsc2UKCiMgVHJ5IHRvIGltcG9ydCBHb29nbGUgQnVzaW5lc3MgUHJvZmlsZSB1dGlsaXRpZXMKR0JQX0FWQUlMQUJMRSA9IEZhbHNlCkdCUF9FUlJPUiA9IE5vbmUKdHJ5OgogICAgZnJvbSB1dGlscy5nYnBfdXRpbHMgaW1wb3J0ICgKICAgICAgICBmZXRjaF9yZXZpZXdzLAogICAgICAgIGZldGNoX3JhdGluZ3Nfc3VtbWFyeSwKICAgICAgICBmZXRjaF9idXNpbmVzc19pbnNpZ2h0cywKICAgICAgICBHQlBfQVZBSUxBQkxFIGFzIEdCUF9MSUJfQVZBSUxBQkxFCiAgICApCiAgICAjIENoZWNrIGlmIGxpYnJhcmllcyBhcmUgYXZhaWxhYmxlIEFORCBjcmVkZW50aWFscyBhcmUgY29uZmlndXJlZAogICAgaGFzX2NyZWRzID0gJ0dPT0dMRV9CVVNJTkVTU19QUk9GSUxFX0NSRURFTlRJQUxTX0I2NCcgaW4gb3MuZW52aXJvbiBvciAnR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTJyBpbiBvcy5lbnZpcm9uCiAgICBoYXNfbG9jYXRpb24gPSAnQlVTSU5FU1NfUFJPRklMRV9MT0NBVElPTl9JRCcgaW4gb3MuZW52aXJvbgogICAgR0JQX0FWQUlMQUJMRSA9IEdCUF9MSUJfQVZBSUxBQkxFIGFuZCBoYXNfY3JlZHMgYW5kIGhhc19sb2NhdGlvbgogICAgaWYgbm90IEdCUF9BVkFJTEFCTEU6CiAgICAgICAgaWYgbm90IEdCUF9MSUJfQVZBSUxBQkxFOgogICAgICAgICAgICBHQlBfRVJST1IgPSAiR0JQIGxpYnJhcmllcyBub3QgaW5zdGFsbGVkIgogICAgICAgIGVsaWYgbm90IGhhc19jcmVkczoKICAgICAgICAgICAgR0JQX0VSUk9SID0gIkdCUCBjcmVkZW50aWFscyBub3QgZm91bmQgaW4gZW52aXJvbm1lbnQiCiAgICAgICAgZWxpZiBub3QgaGFzX2xvY2F0aW9uOgogICAgICAgICAgICBHQlBfRVJST1IgPSAiQlVTSU5FU1NfUFJPRklMRV9MT0NBVElPTl9JRCBub3QgZm91bmQgaW4gZW52aXJvbm1lbnQiCmV4Y2VwdCBJbXBvcnRFcnJvciBhcyBlOgogICAgR0JQX0FWQUlMQUJMRSA9IEZhbHNlCiAgICBHQlBfRVJST1IgPSBmIkltcG9ydCBlcnJvcjoge3N0cihlKX0iCmV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgIEdCUF9BVkFJTEFCTEUgPSBGYWxzZQogICAgR0JQX0VSUk9SID0gZiJFeGNlcHRpb246IHtzdHIoZSl9IgoKIyBDb25maWd1cmF0aW9uClBST1BFUlRZX0lEID0gb3MuZW52aXJvbi5nZXQoIlBST1BFUlRZX0lEIiwgIjM2ODAzNTkzNCIpCgojIEhhbmRsZSBjcmVkZW50aWFscyBmb3IgVmVyY2VsCmlmICdHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFNfQjY0JyBpbiBvcy5lbnZpcm9uOgogICAgaW1wb3J0IGJhc2U2NAogICAgaW1wb3J0IHRlbXBmaWxlCiAgICAKICAgIGNyZWRzX2pzb24gPSBiYXNlNjQuYjY0ZGVjb2RlKG9zLmVudmlyb25bJ0dPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMU19CNjQnXSkuZGVjb2RlKCkKICAgIGNyZWRzX2ZpbGUgPSBvcy5wYXRoLmpvaW4odGVtcGZpbGUuZ2V0dGVtcGRpcigpLCAnY3JlZGVudGlhbHMuanNvbicpCiAgICB3aXRoIG9wZW4oY3JlZHNfZmlsZSwgJ3cnKSBhcyBmOgogICAgICAgIGYud3JpdGUoY3JlZHNfanNvbikKICAgIG9zLmVudmlyb25bJ0dPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUyddID0gY3JlZHNfZmlsZQoKZGVmIGdldF9jbGllbnQoKToKICAgICIiIlJldHVybnMgYXV0aGVudGljYXRlZCBHQTQgY2xpZW50LiIiIgogICAgaWYgbm90IEdBNF9BVkFJTEFCTEU6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJHQTQgbGlicmFyaWVzIG5vdCBhdmFpbGFibGUiKQogICAgcmV0dXJuIEJldGFBbmFseXRpY3NEYXRhQ2xpZW50KCkKCmRlZiBmZXRjaF9hbmFseXRpY3NfZGF0YShzdGFydF9kYXRlOiBzdHIsIGVuZF9kYXRlOiBzdHIsIGRpbWVuc2lvbnM6IGxpc3QsIG1ldHJpY3M6IGxpc3QsIGxpbWl0OiBpbnQgPSAxMDAwMCk6CiAgICAiIiJGZXRjaGVzIGRhdGEgZnJvbSBHQTQgQVBJLiIiIgogICAgY2xpZW50ID0gZ2V0X2NsaWVudCgpCiAgICAKICAgIHJlcXVlc3QgPSBSdW5SZXBvcnRSZXF1ZXN0KAogICAgICAgIHByb3BlcnR5PWYicHJvcGVydGllcy97UFJPUEVSVFlfSUR9IiwKICAgICAgICBkaW1lbnNpb25zPVtEaW1lbnNpb24obmFtZT1kaW0pIGZvciBkaW0gaW4gZGltZW5zaW9uc10sCiAgICAgICAgbWV0cmljcz1bTWV0cmljKG5hbWU9bWV0KSBmb3IgbWV0IGluIG1ldHJpY3NdLAogICAgICAgIGRhdGVfcmFuZ2VzPVtEYXRlUmFuZ2Uoc3RhcnRfZGF0ZT1zdGFydF9kYXRlLCBlbmRfZGF0ZT1lbmRfZGF0ZSldLAogICAgICAgIGxpbWl0PWxpbWl0CiAgICApCiAgICAKICAgIHJlc3BvbnNlID0gY2xpZW50LnJ1bl9yZXBvcnQocmVxdWVzdD1yZXF1ZXN0KQogICAgCiAgICBkYXRhID0gW10KICAgIGZvciByb3cgaW4gcmVzcG9uc2Uucm93czoKICAgICAgICBpdGVtID0ge30KICAgICAgICBmb3IgaSwgZGltIGluIGVudW1lcmF0ZShkaW1lbnNpb25zKToKICAgICAgICAgICAgaXRlbVtkaW1dID0gcm93LmRpbWVuc2lvbl92YWx1ZXNbaV0udmFsdWUKICAgICAgICBmb3IgaSwgbWV0IGluIGVudW1lcmF0ZShtZXRyaWNzKToKICAgICAgICAgICAgaXRlbVttZXRdID0gcm93Lm1ldHJpY192YWx1ZXNbaV0udmFsdWUKICAgICAgICBkYXRhLmFwcGVuZChpdGVtKQogICAgCiAgICByZXR1cm4gZGF0YQoKY2xhc3MgaGFuZGxlcihCYXNlSFRUUFJlcXVlc3RIYW5kbGVyKToKICAgICIiIlZlcmNlbCBQeXRob24gc2VydmVybGVzcyBmdW5jdGlvbiBoYW5kbGVyLiIiIgogICAgCiAgICBkZWYgZG9fR0VUKHNlbGYpOgogICAgICAgICIiIkhhbmRsZSBHRVQgcmVxdWVzdHMuIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwYXJzZWRfcGF0aCA9IHVybHBhcnNlKHNlbGYucGF0aCkKICAgICAgICAgICAgcGF0aCA9IHBhcnNlZF9wYXRoLnBhdGgKICAgICAgICAgICAgcXVlcnlfcGFyYW1zID0gcGFyc2VfcXMocGFyc2VkX3BhdGgucXVlcnkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEhlYWx0aCBjaGVjawogICAgICAgICAgICBpZiBwYXRoID09ICcvYXBpL2hlYWx0aCcgb3IgcGF0aCA9PSAnL2FwaS9oZWFsdGgvJzoKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gewogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiaGVhbHRoeSIsCiAgICAgICAgICAgICAgICAgICAgInByb3BlcnR5X2lkIjogUFJPUEVSVFlfSUQsCiAgICAgICAgICAgICAgICAgICAgImdhNF9hdmFpbGFibGUiOiBHQTRfQVZBSUxBQkxFLAogICAgICAgICAgICAgICAgICAgICJnYnBfYXZhaWxhYmxlIjogR0JQX0FWQUlMQUJMRSwKICAgICAgICAgICAgICAgICAgICAiZ2JwX2Vycm9yIjogR0JQX0VSUk9SCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBEZWJ1ZyBlbmRwb2ludAogICAgICAgICAgICBpZiBwYXRoID09ICcvYXBpL2RlYnVnJyBvciBwYXRoID09ICcvYXBpL2RlYnVnLyc6CiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKQogICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgICAgICAiZ2JwX2F2YWlsYWJsZSI6IEdCUF9BVkFJTEFCTEUsCiAgICAgICAgICAgICAgICAgICAgImdicF9lcnJvciI6IEdCUF9FUlJPUiwKICAgICAgICAgICAgICAgICAgICAiZW52X3ZhcnMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJoYXNfZ2JwX2NyZWRzX2I2NCI6ICdHT09HTEVfQlVTSU5FU1NfUFJPRklMRV9DUkVERU5USUFMU19CNjQnIGluIG9zLmVudmlyb24sCiAgICAgICAgICAgICAgICAgICAgICAgICJoYXNfZ29vZ2xlX2FwcF9jcmVkcyI6ICdHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMnIGluIG9zLmVudmlyb24sCiAgICAgICAgICAgICAgICAgICAgICAgICJoYXNfbG9jYXRpb25faWQiOiAnQlVTSU5FU1NfUFJPRklMRV9MT0NBVElPTl9JRCcgaW4gb3MuZW52aXJvbiwKICAgICAgICAgICAgICAgICAgICAgICAgImxvY2F0aW9uX2lkIjogb3MuZW52aXJvbi5nZXQoJ0JVU0lORVNTX1BST0ZJTEVfTE9DQVRJT05fSUQnLCAnTk9UX1NFVCcpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShqc29uLmR1bXBzKHJlc3BvbnNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgT3ZlcnZpZXcgZW5kcG9pbnQKICAgICAgICAgICAgaWYgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3Mvb3ZlcnZpZXcnIG9yIHBhdGggPT0gJy9hcGkvYW5hbHl0aWNzL292ZXJ2aWV3Lyc6CiAgICAgICAgICAgICAgICBzdGFydF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnc3RhcnRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBlbmRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ2VuZF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHN0YXJ0X2RhdGUgb3Igbm90IGVuZF9kYXRlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDAsICJNaXNzaW5nIHN0YXJ0X2RhdGUgb3IgZW5kX2RhdGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gW10KICAgICAgICAgICAgICAgIG1ldHJpY3MgPSBbJ3Nlc3Npb25zJywgJ3RvdGFsVXNlcnMnLCAnc2NyZWVuUGFnZVZpZXdzJywgJ2JvdW5jZVJhdGUnLCAnYXZlcmFnZVNlc3Npb25EdXJhdGlvbicsICdlbmdhZ2VtZW50UmF0ZSddCiAgICAgICAgICAgICAgICBkYXRhID0gZmV0Y2hfYW5hbHl0aWNzX2RhdGEoc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIGRpbWVuc2lvbnMsIG1ldHJpY3MpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geyJzdWNjZXNzIjogVHJ1ZSwgImRhdGEiOiBkYXRhWzBdIGlmIGRhdGEgZWxzZSB7fX0KICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNvdXJjZXMgZW5kcG9pbnQKICAgICAgICAgICAgaWYgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3Mvc291cmNlcycgb3IgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3Mvc291cmNlcy8nOgogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ3N0YXJ0X2RhdGUnLCBbJyddKVswXQogICAgICAgICAgICAgICAgZW5kX2RhdGUgPSBxdWVyeV9wYXJhbXMuZ2V0KCdlbmRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBsaW1pdCA9IGludChxdWVyeV9wYXJhbXMuZ2V0KCdsaW1pdCcsIFsnMTAnXSlbMF0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRpbWVuc2lvbnMgPSBbJ3Nlc3Npb25Tb3VyY2VNZWRpdW0nXQogICAgICAgICAgICAgICAgbWV0cmljcyA9IFsnc2Vzc2lvbnMnXQogICAgICAgICAgICAgICAgZGF0YSA9IGZldGNoX2FuYWx5dGljc19kYXRhKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBkaW1lbnNpb25zLCBtZXRyaWNzLCBsaW1pdCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7InN1Y2Nlc3MiOiBUcnVlLCAiZGF0YSI6IGRhdGF9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBQYWdlcyBlbmRwb2ludAogICAgICAgICAgICBpZiBwYXRoID09ICcvYXBpL2FuYWx5dGljcy9wYWdlcycgb3IgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3MvcGFnZXMvJzoKICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGUgPSBxdWVyeV9wYXJhbXMuZ2V0KCdzdGFydF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIGVuZF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnZW5kX2RhdGUnLCBbJyddKVswXQogICAgICAgICAgICAgICAgbGltaXQgPSBpbnQocXVlcnlfcGFyYW1zLmdldCgnbGltaXQnLCBbJzE1J10pWzBdKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gWydwYWdlUGF0aCcsICdwYWdlVGl0bGUnXQogICAgICAgICAgICAgICAgbWV0cmljcyA9IFsnc2NyZWVuUGFnZVZpZXdzJywgJ2FjdGl2ZVVzZXJzJ10KICAgICAgICAgICAgICAgIGRhdGEgPSBmZXRjaF9hbmFseXRpY3NfZGF0YShzdGFydF9kYXRlLCBlbmRfZGF0ZSwgZGltZW5zaW9ucywgbWV0cmljcywgbGltaXQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geyJzdWNjZXNzIjogVHJ1ZSwgImRhdGEiOiBkYXRhfQogICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShqc29uLmR1bXBzKHJlc3BvbnNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmV0ZW50aW9uIGVuZHBvaW50CiAgICAgICAgICAgIGlmIHBhdGggPT0gJy9hcGkvYW5hbHl0aWNzL3JldGVudGlvbicgb3IgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3MvcmV0ZW50aW9uLyc6CiAgICAgICAgICAgICAgICBzdGFydF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnc3RhcnRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBlbmRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ2VuZF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGltZW5zaW9ucyA9IFsnbmV3VnNSZXR1cm5pbmcnXQogICAgICAgICAgICAgICAgbWV0cmljcyA9IFsnc2Vzc2lvbnMnXQogICAgICAgICAgICAgICAgZGF0YSA9IGZldGNoX2FuYWx5dGljc19kYXRhKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBkaW1lbnNpb25zLCBtZXRyaWNzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKQogICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsic3VjY2VzcyI6IFRydWUsICJkYXRhIjogZGF0YX0KICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENpdGllcyBlbmRwb2ludAogICAgICAgICAgICBpZiBwYXRoID09ICcvYXBpL2FuYWx5dGljcy9jaXRpZXMnIG9yIHBhdGggPT0gJy9hcGkvYW5hbHl0aWNzL2NpdGllcy8nOgogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ3N0YXJ0X2RhdGUnLCBbJyddKVswXQogICAgICAgICAgICAgICAgZW5kX2RhdGUgPSBxdWVyeV9wYXJhbXMuZ2V0KCdlbmRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBsaW1pdCA9IGludChxdWVyeV9wYXJhbXMuZ2V0KCdsaW1pdCcsIFsnMTAnXSlbMF0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRpbWVuc2lvbnMgPSBbJ2NpdHknXQogICAgICAgICAgICAgICAgbWV0cmljcyA9IFsnc2Vzc2lvbnMnXQogICAgICAgICAgICAgICAgZGF0YSA9IGZldGNoX2FuYWx5dGljc19kYXRhKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBkaW1lbnNpb25zLCBtZXRyaWNzLCBsaW1pdCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7InN1Y2Nlc3MiOiBUcnVlLCAiZGF0YSI6IGRhdGF9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBDb3VudHJpZXMgZW5kcG9pbnQKICAgICAgICAgICAgaWYgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3MvY291bnRyaWVzJyBvciBwYXRoID09ICcvYXBpL2FuYWx5dGljcy9jb3VudHJpZXMvJzoKICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGUgPSBxdWVyeV9wYXJhbXMuZ2V0KCdzdGFydF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIGVuZF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnZW5kX2RhdGUnLCBbJyddKVswXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gWydjb3VudHJ5J10KICAgICAgICAgICAgICAgIG1ldHJpY3MgPSBbJ3Nlc3Npb25zJ10KICAgICAgICAgICAgICAgIGRhdGEgPSBmZXRjaF9hbmFseXRpY3NfZGF0YShzdGFydF9kYXRlLCBlbmRfZGF0ZSwgZGltZW5zaW9ucywgbWV0cmljcykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7InN1Y2Nlc3MiOiBUcnVlLCAiZGF0YSI6IGRhdGF9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBEZXZpY2VzIGVuZHBvaW50CiAgICAgICAgICAgIGlmIHBhdGggPT0gJy9hcGkvYW5hbHl0aWNzL2RldmljZXMnIG9yIHBhdGggPT0gJy9hcGkvYW5hbHl0aWNzL2RldmljZXMvJzoKICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGUgPSBxdWVyeV9wYXJhbXMuZ2V0KCdzdGFydF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIGVuZF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnZW5kX2RhdGUnLCBbJyddKVswXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gWydkZXZpY2VDYXRlZ29yeSddCiAgICAgICAgICAgICAgICBtZXRyaWNzID0gWydzZXNzaW9ucyddCiAgICAgICAgICAgICAgICBkYXRhID0gZmV0Y2hfYW5hbHl0aWNzX2RhdGEoc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIGRpbWVuc2lvbnMsIG1ldHJpY3MpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geyJzdWNjZXNzIjogVHJ1ZSwgImRhdGEiOiBkYXRhfQogICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShqc29uLmR1bXBzKHJlc3BvbnNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgRXZlbnRzIGVuZHBvaW50CiAgICAgICAgICAgIGlmIHBhdGggPT0gJy9hcGkvYW5hbHl0aWNzL2V2ZW50cycgb3IgcGF0aCA9PSAnL2FwaS9hbmFseXRpY3MvZXZlbnRzLyc6CiAgICAgICAgICAgICAgICBzdGFydF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnc3RhcnRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBlbmRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ2VuZF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIGxpbWl0ID0gaW50KHF1ZXJ5X3BhcmFtcy5nZXQoJ2xpbWl0JywgWycyMCddKVswXSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGltZW5zaW9ucyA9IFsnZXZlbnROYW1lJ10KICAgICAgICAgICAgICAgIG1ldHJpY3MgPSBbJ2V2ZW50Q291bnQnXQogICAgICAgICAgICAgICAgZGF0YSA9IGZldGNoX2FuYWx5dGljc19kYXRhKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBkaW1lbnNpb25zLCBtZXRyaWNzLCBsaW1pdCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7InN1Y2Nlc3MiOiBUcnVlLCAiZGF0YSI6IGRhdGF9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBCdXNpbmVzcyBQcm9maWxlIFJldmlld3MgZW5kcG9pbnQKICAgICAgICAgICAgaWYgcGF0aCA9PSAnL2FwaS9idXNpbmVzcy1wcm9maWxlL3Jldmlld3MnIG9yIHBhdGggPT0gJy9hcGkvYnVzaW5lc3MtcHJvZmlsZS9yZXZpZXdzLyc6CiAgICAgICAgICAgICAgICBpZiBub3QgR0JQX0FWQUlMQUJMRToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAzLCAiR29vZ2xlIEJ1c2luZXNzIFByb2ZpbGUgQVBJIG5vdCBhdmFpbGFibGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdGFydF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnc3RhcnRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBlbmRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ2VuZF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIGxpbWl0ID0gaW50KHF1ZXJ5X3BhcmFtcy5nZXQoJ2xpbWl0JywgWyc1MCddKVswXSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHN0YXJ0X2RhdGUgb3Igbm90IGVuZF9kYXRlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDAsICJNaXNzaW5nIHN0YXJ0X2RhdGUgb3IgZW5kX2RhdGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmV2aWV3cyA9IGZldGNoX3Jldmlld3Moc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIGxpbWl0KQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsic3VjY2VzcyI6IFRydWUsICJkYXRhIjogcmV2aWV3c30KICAgICAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAjIFJldHVybiBlcnJvciBkZXRhaWxzIGZvciBkZWJ1Z2dpbmcKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoNTAwKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7InN1Y2Nlc3MiOiBGYWxzZSwgImVycm9yIjogc3RyKGUpLCAiZGF0YSI6IFtdfQogICAgICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBCdXNpbmVzcyBQcm9maWxlIFJhdGluZ3MgZW5kcG9pbnQKICAgICAgICAgICAgaWYgcGF0aCA9PSAnL2FwaS9idXNpbmVzcy1wcm9maWxlL3JhdGluZ3MnIG9yIHBhdGggPT0gJy9hcGkvYnVzaW5lc3MtcHJvZmlsZS9yYXRpbmdzLyc6CiAgICAgICAgICAgICAgICBpZiBub3QgR0JQX0FWQUlMQUJMRToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAzLCAiR29vZ2xlIEJ1c2luZXNzIFByb2ZpbGUgQVBJIG5vdCBhdmFpbGFibGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmF0aW5ncyA9IGZldGNoX3JhdGluZ3Nfc3VtbWFyeSgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKQogICAgICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geyJzdWNjZXNzIjogVHJ1ZSwgImRhdGEiOiByYXRpbmdzfQogICAgICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDAsIGYiRXJyb3IgZmV0Y2hpbmcgcmF0aW5nczoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBCdXNpbmVzcyBQcm9maWxlIEluc2lnaHRzIGVuZHBvaW50CiAgICAgICAgICAgIGlmIHBhdGggPT0gJy9hcGkvYnVzaW5lc3MtcHJvZmlsZS9pbnNpZ2h0cycgb3IgcGF0aCA9PSAnL2FwaS9idXNpbmVzcy1wcm9maWxlL2luc2lnaHRzLyc6CiAgICAgICAgICAgICAgICBpZiBub3QgR0JQX0FWQUlMQUJMRToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAzLCAiR29vZ2xlIEJ1c2luZXNzIFByb2ZpbGUgQVBJIG5vdCBhdmFpbGFibGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdGFydF9kYXRlID0gcXVlcnlfcGFyYW1zLmdldCgnc3RhcnRfZGF0ZScsIFsnJ10pWzBdCiAgICAgICAgICAgICAgICBlbmRfZGF0ZSA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ2VuZF9kYXRlJywgWycnXSlbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHN0YXJ0X2RhdGUgb3Igbm90IGVuZF9kYXRlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDAsICJNaXNzaW5nIHN0YXJ0X2RhdGUgb3IgZW5kX2RhdGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaW5zaWdodHMgPSBmZXRjaF9idXNpbmVzc19pbnNpZ2h0cyhzdGFydF9kYXRlLCBlbmRfZGF0ZSkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7InN1Y2Nlc3MiOiBUcnVlLCAiZGF0YSI6IGluc2lnaHRzfQogICAgICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDAsIGYiRXJyb3IgZmV0Y2hpbmcgaW5zaWdodHM6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGVzdCBHQlAgQVBJIGVuZHBvaW50CiAgICAgICAgICAgIGlmIHBhdGggPT0gJy9hcGkvYnVzaW5lc3MtcHJvZmlsZS90ZXN0JyBvciBwYXRoID09ICcvYXBpL2J1c2luZXNzLXByb2ZpbGUvdGVzdC8nOgogICAgICAgICAgICAgICAgaWYgbm90IEdCUF9BVkFJTEFCTEU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDUwMykKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKQogICAgICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geyJzdWNjZXNzIjogRmFsc2UsICJlcnJvciI6ICJHQlAgbm90IGF2YWlsYWJsZSIsICJnYnBfZXJyb3IiOiBHQlBfRVJST1J9CiAgICAgICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShqc29uLmR1bXBzKHJlc3BvbnNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBmcm9tIHV0aWxzLmdicF91dGlscyBpbXBvcnQgZ2V0X2J1c2luZXNzX3Byb2ZpbGVfY2xpZW50LCBnZXRfbG9jYXRpb25faWQKICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlID0gZ2V0X2J1c2luZXNzX3Byb2ZpbGVfY2xpZW50KCkKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZCA9IGdldF9sb2NhdGlvbl9pZCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gbWFrZSBhIHNpbXBsZSBBUEkgY2FsbAogICAgICAgICAgICAgICAgICAgIHRlc3RfcmVzdWx0ID0gewogICAgICAgICAgICAgICAgICAgICAgICAiY2xpZW50X2J1aWx0IjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgImxvY2F0aW9uX2lkIjogbG9jYXRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJzZXJ2aWNlX3R5cGUiOiB0eXBlKHNlcnZpY2UpLl9fbmFtZV9fLAogICAgICAgICAgICAgICAgICAgICAgICAiaGFzX2FjY291bnRzIjogaGFzYXR0cihzZXJ2aWNlLCAnYWNjb3VudHMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgImhhc19sb2NhdGlvbnMiOiBoYXNhdHRyKHNlcnZpY2UsICdsb2NhdGlvbnMnKSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gbGlzdCBhY2NvdW50cyBpZiBhdmFpbGFibGUKICAgICAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKHNlcnZpY2UsICdhY2NvdW50cycpOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50cyA9IHNlcnZpY2UuYWNjb3VudHMoKS5saXN0KCkuZXhlY3V0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0X3Jlc3VsdFsiYWNjb3VudHMiXSA9IGFjY291bnRzLmdldCgnYWNjb3VudHMnLCBbXSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9yZXN1bHRbImFjY291bnRzX2Vycm9yIl0gPSBzdHIoZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byBmZXRjaCByZXZpZXdzIHVzaW5nIGxvY2F0aW9ucyBBUEkKICAgICAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKHNlcnZpY2UsICdsb2NhdGlvbnMnKToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayB3aGF0IG1ldGhvZHMgYXJlIGF2YWlsYWJsZSBvbiBsb2NhdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uc19vYmogPSBzZXJ2aWNlLmxvY2F0aW9ucygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0X3Jlc3VsdFsibG9jYXRpb25zX21ldGhvZHMiXSA9IFttIGZvciBtIGluIGRpcihsb2NhdGlvbnNfb2JqKSBpZiBub3QgbS5zdGFydHN3aXRoKCdfJyldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQnVzaW5lc3MgUHJvZmlsZSBQZXJmb3JtYW5jZSBBUEkgdXNlcyBkaWZmZXJlbnQgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRyeTogbG9jYXRpb25zKCkuZmV0Y2hNdWx0aURhaWx5TWV0cmljc1RpbWVTZXJpZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBPcjogbG9jYXRpb25zKCkuZmV0Y2hEYWlseU1ldHJpY3NUaW1lU2VyaWVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgT3I6IGxvY2F0aW9ucygpLmdldERhaWx5TWV0cmljc1RpbWVTZXJpZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEZvciByZXZpZXdzLCB3ZSBtaWdodCBuZWVkIHRvIHVzZSBhIGRpZmZlcmVudCBBUEkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGhlIEJ1c2luZXNzIFByb2ZpbGUgUGVyZm9ybWFuY2UgQVBJIG1pZ2h0IG5vdCBoYXZlIHJldmlld3MgZW5kcG9pbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmV2aWV3cyBtaWdodCBiZSBpbiB0aGUgTXkgQnVzaW5lc3MgQVBJIGluc3RlYWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0X3Jlc3VsdFsibG9jYXRpb25zX3Rlc3RfZXJyb3IiXSA9IHN0cihlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsic3VjY2VzcyI6IFRydWUsICJkYXRhIjogdGVzdF9yZXN1bHR9CiAgICAgICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShqc29uLmR1bXBzKHJlc3BvbnNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDUwMCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKQogICAgICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geyJzdWNjZXNzIjogRmFsc2UsICJlcnJvciI6IHN0cihlKSwgImVycm9yX3R5cGUiOiB0eXBlKGUpLl9fbmFtZV9ffQogICAgICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBSb290IEFQSSBlbmRwb2ludAogICAgICAgICAgICBpZiBwYXRoID09ICcvYXBpJyBvciBwYXRoID09ICcvYXBpLyc6CiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKQogICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICJUZW5hY2lvdXMgU3RhdHMgQVBJIiwKICAgICAgICAgICAgICAgICAgICAidmVyc2lvbiI6ICIxLjAuMCIsCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6ICJydW5uaW5nIiwKICAgICAgICAgICAgICAgICAgICAiZ2E0X2F2YWlsYWJsZSI6IEdBNF9BVkFJTEFCTEUsCiAgICAgICAgICAgICAgICAgICAgImdicF9hdmFpbGFibGUiOiBHQlBfQVZBSUxBQkxFCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyA0MDQgZm9yIHVua25vd24gZW5kcG9pbnRzCiAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsICJOb3QgRm91bmQiKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDAsIGYiU2VydmVyIEVycm9yOiB7c3RyKGUpfSIpCiAgICAKICAgIGRlZiBkb19PUFRJT05TKHNlbGYpOgogICAgICAgICIiIkhhbmRsZSBDT1JTIHByZWZsaWdodCByZXF1ZXN0cy4iIiIKICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJykKICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCwgUE9TVCwgT1BUSU9OUycpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycycsICdDb250ZW50LVR5cGUnKQogICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgCiAgICBkZWYgbG9nX21lc3NhZ2Uoc2VsZiwgZm9ybWF0LCAqYXJncyk6CiAgICAgICAgIiIiU3VwcHJlc3MgZGVmYXVsdCBsb2dnaW5nLiIiIgogICAgICAgIHBhc3MK"}